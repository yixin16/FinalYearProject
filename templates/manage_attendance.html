<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Attendance - {{ section.course_code }} - Attendance System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #2e59d9;
            --success-color: #1cc88a;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --light-color: #f8f9fc;
            --dark-color: #5a5c69;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fc;
            color: var(--dark-color);
        }

        .container {
            max-width: 1400px;
            margin-top: 30px;
            margin-bottom: 50px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e3e6f0;
        }

        .page-header h1 {
            color: var(--dark-color);
            font-weight: 700;
            margin: 0;
        }

        .back-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            border-radius: 5px;
        }

        .back-btn:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            margin-bottom: 30px;
        }

        .filter-form .form-label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        }

        .table {
            margin-top: 20px;
        }

        .table th {
            background-color: #f8f9fc;
            color: var(--dark-color);
            font-weight: 700;
            border-top: none;
        }

        .status-present {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-absent {
            color: var(--danger-color);
            font-weight: 600;
        }

        .status-late {
            color: var(--warning-color);
            font-weight: 600;
        }

        .status-excused {
            color: #6c757d;
            font-weight: 600;
        }

        .action-btn {
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8rem;
            transition: transform 0.2s;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .btn-present {
            background-color: var(--success-color);
            color: white;
        }

        .btn-absent {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-late {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-excused {
            background-color: #6c757d;
            color: white;
        }

        .attendance-summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-card {
            padding: 15px;
            border-radius: 8px;
            width: 22%;
            transition: transform 0.3s;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-present {
            background-color: rgba(28, 200, 138, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .summary-absent {
            background-color: rgba(231, 74, 59, 0.1);
            border-left: 4px solid var(--danger-color);
        }

        .summary-late {
            background-color: rgba(246, 194, 62, 0.1);
            border-left: 4px solid var(--warning-color);
        }

        .summary-total {
            background-color: rgba(78, 115, 223, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .session-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .qr-code-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fc;
            border-radius: 8px;
            transition: all 0.3s;
            display: none;
        }

        .qr-code-container.active {
            background: #e9f7ef;
            border: 1px solid var(--success-color);
            display: block;
        }

        .qr-timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--danger-color);
        }

        .badge-method {
            font-size: 0.75rem;
            padding: 4px 8px;
        }

        .badge-qr {
            background-color: #4e73df;
            color: white;
        }

        .badge-face {
            background-color: #1cc88a;
            color: white;
        }

        .badge-manual {
            background-color: #f6c23e;
            color: #000;
        }

        .badge-remote {
            background-color: #36b9cc;
            color: white;
        }

        .action-dropdown {
            min-width: 120px;
        }

        .export-options {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .section-info {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .session-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .session-active {
            background-color: var(--success-color);
            color: white;
        }

        .session-inactive {
            background-color: #858796;
            color: white;
        }

        @media (max-width: 768px) {
            .attendance-summary {
                flex-direction: column;
            }

            .summary-card {
                width: 100%;
                margin-bottom: 10px;
            }

            .session-controls {
                flex-direction: column;
            }

            .table td,
            .table th {
                white-space: nowrap;
            }
        }

        /* Animation for status changes */
        @keyframes statusChange {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .status-updated {
            animation: statusChange 0.5s ease;
        }

        .flashes {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .flash-message {
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            animation: slideIn 0.5s forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .flash-success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success-color);
        }

        .flash-danger {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger-color);
        }

        .flash-warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning-color);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="page-header">
            <h1><i class="bi bi-clipboard2-check"></i> Manage Attendance</h1>
            <a href="{{ url_for('lecturer_dashboard') }}" class="btn back-btn">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>

        <!-- Filter Panel -->
        <div class="control-panel">
            <h4><i class="bi bi-funnel"></i> Filter Attendance Records</h4>
            <form class="filter-form mt-3" id="attendanceFilterForm">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="student-select" class="form-label">Student</label>
                        <select class="form-select" id="student-select" name="student">
                            <option value="" selected>All Students</option>
                            {% for student in enrolled_students %}
                            <option value="{{ student.id }}">{{ student.name }} ({{ student.student_id }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="date-range" class="form-label">Date Range</label>
                        <input type="text" class="form-control" id="date-range" name="date_range"
                            placeholder="Select date range">
                    </div>
                    <div class="col-md-3">
                        <label for="status-select" class="form-label">Status</label>
                        <select class="form-select" id="status-select" name="status">
                            <option value="" selected>All Statuses</option>
                            <option value="present">Present</option>
                            <option value="absent">Absent</option>
                            <option value="late">Late</option>
                            <option value="excused">Excused</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary me-2"><i class="bi bi-filter"></i> Apply</button>
                        <button type="reset" class="btn btn-outline-secondary"><i
                                class="bi bi-arrow-counterclockwise"></i> Reset</button>
                    </div>
                </div>
            </form>

            <!-- Session Controls -->
            <div class="session-controls mt-4">
                <button class="btn btn-success" id="startLiveSession"><i class="bi bi-camera-video"></i> Start Live
                    Session</button>
                <button class="btn btn-primary" id="generateQR"><i class="bi bi-qr-code"></i> Generate QR Code</button>
                <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#manualEntryModal"><i
                        class="bi bi-pencil"></i> Manual Entry</button>
                <button class="btn btn-info"><i class="bi bi-graph-up"></i> View Stats</button>
            </div>

            <div class="qr-code-container" id="qrCodeContainer">
                <h4><i class="bi bi-qr-code"></i> Class QR Code</h4>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=CLASS_ID:12345&margin=10"
                    alt="Attendance QR Code" class="img-fluid mb-2" id="qrCodeImage">
                <p class="text-muted">Scan this code with the student app to mark attendance</p>
                <p>Session active for: <span class="qr-timer" id="qrTimer">15:00</span></p>
                <button class="btn btn-sm btn-danger" id="stopSessionBtn">
                    <i class="bi bi-stop-circle"></i> End Session
                </button>
            </div>
        </div>


        <!-- Attendance Summary -->
        <div class="attendance-summary">
            {% set total_students = enrolled_students|length %}
            {% set present_count = attendance_records|selectattr('status', 'equalto', 'present')|list|length %}
            {% set absent_count = attendance_records|selectattr('status', 'equalto', 'absent')|list|length %}
            {% set late_count = attendance_records|selectattr('status', 'equalto', 'late')|list|length %}
            {% set excused_count = attendance_records|selectattr('status', 'equalto', 'excused')|list|length %}

            <div class="summary-card summary-present">
                <div class="summary-label"><i class="bi bi-check-circle"></i> Present</div>
                <div class="summary-value">{{ present_count }}</div>
                <div class="summary-detail">
                    {% if total_students > 0 %}
                    {{ ((present_count / total_students) * 100)|round(1) }}% of class
                    {% else %}
                    0%
                    {% endif %}
                </div>
            </div>

            <div class="summary-card summary-absent">
                <div class="summary-label"><i class="bi bi-x-circle"></i> Absent</div>
                <div class="summary-value">{{ absent_count }}</div>
                <div class="summary-detail">
                    {% if total_students > 0 %}
                    {{ ((absent_count / total_students) * 100)|round(1) }}% of class
                    {% else %}
                    0%
                    {% endif %}
                </div>
            </div>

            <div class="summary-card summary-late">
                <div class="summary-label"><i class="bi bi-clock"></i> Late</div>
                <div class="summary-value">{{ late_count }}</div>
                <div class="summary-detail">
                    {% if total_students > 0 %}
                    {{ ((late_count / total_students) * 100)|round(1) }}% of class
                    {% else %}
                    0%
                    {% endif %}
                </div>
            </div>

            <div class="summary-card summary-total">
                <div class="summary-label"><i class="bi bi-people"></i> Total</div>
                <div class="summary-value">{{ total_students }}</div>
                <div class="summary-detail">Students enrolled</div>
            </div>
        </div>

        <!-- Attendance Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4><i class="bi bi-list-check"></i> Attendance Records</h4>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="realTimeToggle" checked>
                    <label class="form-check-label" for="realTimeToggle">Live Updates</label>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" id="attendanceTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Student</th>
                            <th>ID</th>
                            <th>Status</th>
                            <th>Time</th>
                            <th>Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in attendance_records %}
                        <tr data-record-id="{{ record.id }}">
                            <td>{{ record.timestamp.strftime('%Y-%m-%d') }}</td>
                            <td>{{ record.name }}</td>
                            <td>{{ record.student_id }}</td>
                            <td class="status-{{ record.status }}">{{ record.status|capitalize }}</td>
                            <td>{{ record.timestamp.strftime('%H:%M:%S') }}</td>
                            <td>
                                <span class="badge badge-method
                            {% if record.method=='qr' %}badge-qr
                            {% elif record.method=='face' %}badge-face
                            {% elif record.method=='manual' %}badge-manual
                            {% else %}badge-remote{% endif %}">
                                    {{ record.method|capitalize }}
                                </span>
                            </td>
                            <td>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown">
                                        <i class="bi bi-gear"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item status-option" href="#" data-status="present">Mark
                                                Present</a></li>
                                        <li><a class="dropdown-item status-option" href="#" data-status="absent">Mark
                                                Absent</a></li>
                                        <li><a class="dropdown-item status-option" href="#" data-status="late">Mark
                                                Late</a></li>
                                        <li><a class="dropdown-item status-option" href="#" data-status="excused">Mark
                                                Excused</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-center">No attendance records found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <nav aria-label="Attendance pagination">
        <ul class="pagination justify-content-center mt-4">
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1"><i class="bi bi-chevron-left"></i></a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#"><i class="bi bi-chevron-right"></i></a>
            </li>
        </ul>
    </nav>
    </div>
    </div>

    <!-- Manual Entry Modal -->
    <div class="modal fade" id="manualEntryModal" tabindex="-1" aria-labelledby="manualEntryModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manualEntryModalLabel"><i class="bi bi-pencil"></i> Manual Attendance
                        Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="manualEntryForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="manualCourse" class="form-label">Course</label>
                                <select class="form-select" id="manualCourse" required>
                                    <option value="" selected disabled>Select course</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.course_code }} - {{ course.course_name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="manualDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="manualDate" required>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>ID</th>
                                        <th>Status</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in students %}
                                    <tr>
                                        <td>{{ student.name }}</td>
                                        <td>{{ student.student_id }}</td>
                                        <td>
                                            <select class="form-select form-select-sm status-select"
                                                data-student-id="{{ student.id }}">
                                                <option value="present">Present</option>
                                                <option value="absent" selected>Absent</option>
                                                <option value="late">Late</option>
                                                <option value="excused">Excused</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control form-control-sm"
                                                placeholder="Optional notes">
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveManualEntry">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="notesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="notesModalLabel"><i class="bi bi-pencil-square"></i> Attendance Notes
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="notesForm">
                        <input type="hidden" id="notesRecordId">
                        <div class="mb-3">
                            <label for="notesText" class="form-label">Notes</label>
                            <textarea class="form-control" id="notesText" rows="3"
                                placeholder="Enter any notes about this attendance record..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveNotes">Save Notes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Initialize date range picker
        flatpickr("#date-range", {
            mode: "range",
            dateFormat: "Y-m-d",
            defaultDate: [new Date().fp_incr(-7), new Date()]
        });

        // Initialize manual entry date picker
        flatpickr("#manualDate", {
            dateFormat: "Y-m-d",
            defaultDate: new Date()
        });

        // QR Code Session Management
        const qrCodeContainer = document.getElementById('qrCodeContainer');
        const generateQRBtn = document.getElementById('generateQR');
        const stopSessionBtn = document.getElementById('stopSessionBtn');
        const qrTimer = document.getElementById('qrTimer');

        let sessionInterval;
        let secondsRemaining = 900; // 15 minutes

        generateQRBtn.addEventListener('click', function () {
            qrCodeContainer.style.display = 'block';
            qrCodeContainer.classList.add('active');

            // Generate a random session ID for the QR code
            const sessionId = 'SESSION_' + Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('qrCodeImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${sessionId}&margin=10`;

            // Start the countdown timer
            secondsRemaining = 900;
            updateTimerDisplay();

            sessionInterval = setInterval(function () {
                secondsRemaining--;
                updateTimerDisplay();

                if (secondsRemaining <= 0) {
                    clearInterval(sessionInterval);
                    qrCodeContainer.classList.remove('active');
                }
            }, 1000);

            // Simulate live attendance updates
            simulateLiveAttendance();
        });

        stopSessionBtn.addEventListener('click', function () {
            clearInterval(sessionInterval);
            qrCodeContainer.classList.remove('active');
            secondsRemaining = 0;
            updateTimerDisplay();
        });

        function updateTimerDisplay() {
            const minutes = Math.floor(secondsRemaining / 60);
            const seconds = secondsRemaining % 60;
            qrTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (secondsRemaining <= 60) {
                qrTimer.classList.add('text-danger');
            } else {
                qrTimer.classList.remove('text-danger');
            }
        }

        // Status change handling
        document.querySelectorAll('.status-option').forEach(option => {
            option.addEventListener('click', function (e) {
                e.preventDefault();
                const status = this.getAttribute('data-status');
                const row = this.closest('tr');

                // Update the status cell
                const statusCell = row.querySelector('td:nth-child(5)');
                statusCell.className = `status-${status}`;
                statusCell.textContent = status.charAt(0).toUpperCase() + status.slice(1);

                // Add animation
                statusCell.classList.add('status-updated');
                setTimeout(() => {
                    statusCell.classList.remove('status-updated');
                }, 500);

                // Here you would send an AJAX request to update the status in the database
                console.log(`Updated record ${row.getAttribute('data-record-id')} to ${status}`);
            });
        });

        // Notes modal handling
        const notesModal = document.getElementById('notesModal');
        notesModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const recordId = button.getAttribute('data-record-id');
            document.getElementById('notesRecordId').value = recordId;

            // Here you would fetch existing notes for this record if any
        });

        document.getElementById('saveNotes').addEventListener('click', function () {
            const recordId = document.getElementById('notesRecordId').value;
            const notes = document.getElementById('notesText').value;

            // Here you would save the notes via AJAX
            console.log(`Saving notes for record ${recordId}: ${notes}`);

            // Close the modal
            bootstrap.Modal.getInstance(notesModal).hide();
        });

        // Manual entry save
        document.getElementById('saveManualEntry').addEventListener('click', function () {
            const courseId = document.getElementById('manualCourse').value;
            const date = document.getElementById('manualDate').value;
            const attendanceData = [];

            document.querySelectorAll('#manualEntryForm tbody tr').forEach(row => {
                const studentId = row.querySelector('.status-select').getAttribute('data-student-id');
                const status = row.querySelector('.status-select').value;
                const notes = row.querySelector('input[type="text"]').value;

                attendanceData.push({
                    studentId,
                    status,
                    notes
                });
            });

            // Here you would send this data to the server
            console.log('Saving manual attendance:', {
                courseId,
                date,
                attendanceData
            });

            // Close the modal
            bootstrap.Modal.getInstance(document.getElementById('manualEntryModal')).hide();

            // Show success message
            alert('Attendance records saved successfully!');
        });

        // Simulate live attendance updates
        function simulateLiveAttendance() {
            const attendanceTable = document.getElementById('attendanceTable');
            const rows = attendanceTable.querySelectorAll('tbody tr');

            setInterval(() => {
                if (!document.getElementById('realTimeToggle').checked) return;

                // Randomly update some records
                if (Math.random() > 0.7) {
                    const randomRow = rows[Math.floor(Math.random() * rows.length)];
                    const statusCell = randomRow.querySelector('td:nth-child(5)');
                    const methodCell = randomRow.querySelector('td:nth-child(7)');

                    // Random status (weighted toward present)
                    const statusOptions = ['present', 'present', 'present', 'late', 'absent'];
                    const newStatus = statusOptions[Math.floor(Math.random() * statusOptions.length)];

                    // Update status
                    statusCell.className = `status-${newStatus}`;
                    statusCell.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                    statusCell.classList.add('status-updated');

                    // Update method
                    const methodOptions = ['qr', 'face', 'manual'];
                    const newMethod = methodOptions[Math.floor(Math.random() * methodOptions.length)];
                    methodCell.innerHTML = `<span class="badge badge-method badge-${newMethod}">${newMethod.charAt(0).toUpperCase() + newMethod.slice(1)}</span>`;

                    setTimeout(() => {
                        statusCell.classList.remove('status-updated');
                    }, 500);
                }
            }, 3000);
        }

        // Form submission
        document.getElementById('attendanceFilterForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            // Here you would send the filter criteria to the server and update the table
            console.log('Filtering with:', Object.fromEntries(formData));

            // Simulate loading
            const tableContainer = document.querySelector('.table-container');
            tableContainer.style.opacity = '0.5';

            setTimeout(() => {
                tableContainer.style.opacity = '1';
            }, 800);
        });
    </script>
</body>

</html>